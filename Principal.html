<!DOCTYPE html>
<html lang="es" ng-app="tiendaApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Shadow Store Online</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="Estilo.css">
</head>
<body ng-controller="TiendaController">
    
    <!-- Header con carrito -->
    <header class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="logo-container">
                        <img src="logo.png" alt="The Shadow Store Logo" class="logo-img">
                        <h1 class="logo">The Shadow Store</h1>
                    </div>
                </div>
                <div class="col-md-6 text-right">
                    <div class="carrito-header" ng-click="abrirCarrito()">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="precio-total">${{totalCarrito | number:2}}</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Slider de imágenes -->
    <section class="slider-section">
        <div id="carouselSlider" class="carousel slide" data-ride="carousel" data-interval="5000">
            <ol class="carousel-indicators">
                <li data-target="#carouselSlider" data-slide-to="0" class="active"></li>
                <li data-target="#carouselSlider" data-slide-to="1"></li>
                <li data-target="#carouselSlider" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="banner%20zapatos.png" class="d-block w-100" alt="Slide 1">
                </div>
                <div class="carousel-item">
                    <img src="banner%20camisas.png" class="d-block w-100" alt="Slide 2">
                </div>
                <div class="carousel-item">
                    <img src="banner%20pantalones.png" class="d-block w-100" alt="Slide 3">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselSlider" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            </a>
            <a class="carousel-control-next" href="#carouselSlider" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
            </a>
        </div>
    </section>

    <!-- Filtros y productos -->
    <section class="productos-section">
        <div class="container">
            <h2 class="section-title">Productos de la categoría: <span class="categoria-actual">{{categoriaSeleccionada || 'Todos'}}</span></h2>
            
            <!-- Búsqueda y filtros -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" 
                               class="form-control" 
                               ng-model="busqueda" 
                               placeholder="Buscar productos...">
                    </div>
                </div>
                <div class="col-md-6">
                    <select class="form-control filtro-categoria" 
                            ng-model="categoriaSeleccionada"
                            ng-options="categoria for categoria in categorias">
                        <option value="">Todas las categorías</option>
                    </select>
                </div>
            </div>

            <!-- Grid de productos -->
            <div class="row">
                <div class="col-md-4 mb-4" 
                     ng-repeat="producto in productosFiltrados = (productos | filter:filtrarPorCategoria | filter:busqueda)">
                    <div class="producto-card">
                        <div class="producto-imagen">
                            <img src="{{producto.imagen}}" alt="{{producto.nombre}}">
                            <div class="stock-badge" ng-class="{'stock-bajo': producto.stock < 10, 'stock-agotado': producto.stock === 0}">
                                <i class="fas fa-box"></i> {{producto.stock}} disponibles
                            </div>
                        </div>
                        <div class="producto-info">
                            <h3 class="producto-nombre">{{producto.nombre}}</h3>
                            <div class="producto-rating">
                                <i class="fas fa-star" ng-repeat="star in getStars(producto.rating)"></i>
                            </div>
                            <p class="producto-descripcion">{{producto.descripcion}}</p>
                            <div class="producto-precio">${{producto.precio | number:2}}</div>
                            <div class="producto-actions">
                                <button class="btn btn-mas-info" ng-click="verDetalles(producto)" ng-disabled="producto.stock === 0">
                                    Ver más
                                </button>
                                <button class="btn btn-detalles" ng-click="verDetalles(producto)" ng-disabled="producto.stock === 0">
                                    {{producto.stock === 0 ? 'AGOTADO' : 'DETALLES'}}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mensaje si no hay productos -->
            <div class="row" ng-if="productosFiltrados.length === 0">
                <div class="col-12">
                    <div class="alert alert-info text-center">
                        No se encontraron productos que coincidan con tu búsqueda.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal de detalles del producto -->
    <div class="modal fade" id="modalDetalles" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{productoSeleccionado.nombre}}</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <img src="{{productoSeleccionado.imagen}}" class="img-fluid" alt="{{productoSeleccionado.nombre}}">
                        </div>
                        <div class="col-md-6">
                            <div class="producto-rating mb-3">
                                <i class="fas fa-star" ng-repeat="star in getStars(productoSeleccionado.rating)"></i>
                            </div>
                            <p class="producto-descripcion-completa">{{productoSeleccionado.descripcionCompleta}}</p>
                            <h3 class="producto-precio-modal">${{productoSeleccionado.precio | number:2}}</h3>
                            <div class="form-group">
                                <label>Categoría:</label>
                                <span class="badge badge-primary">{{productoSeleccionado.categoria}}</span>
                            </div>
                            <div class="form-group">
                                <label>Stock disponible:</label>
                                <span class="badge badge-success">{{productoSeleccionado.stock}} unidades</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-cancelar" data-dismiss="modal">CANCELAR</button>
                    <button type="button" class="btn btn-agregar" ng-click="agregarAlCarrito(productoSeleccionado)" ng-disabled="productoSeleccionado.stock === 0">
                        <i class="fas fa-shopping-cart"></i> {{productoSeleccionado.stock === 0 ? 'AGOTADO' : 'AGREGAR'}}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal del carrito de compras -->
    <div class="modal fade" id="modalCarrito" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Carrito de Compra</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Contenido del carrito -->
                    <div ng-if="!mostrarFormularioPago">
                        <div ng-if="carrito.length === 0" class="alert alert-info text-center">
                            Tu carrito está vacío
                        </div>
                        
                        <table class="table table-carrito" ng-if="carrito.length > 0">
                            <thead>
                                <tr>
                                    <th>PRODUCTO</th>
                                    <th>PRECIO</th>
                                    <th>CANTIDAD</th>
                                    <th>SUB TOTAL</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in carrito">
                                    <td>{{item.producto.nombre}}</td>
                                    <td>${{item.producto.precio | number:2}}</td>
                                    <td>
                                        <div class="cantidad-control">
                                            <button class="btn btn-sm btn-secondary" ng-click="disminuirCantidad(item)">-</button>
                                            <span class="cantidad">{{item.cantidad}}</span>
                                            <button class="btn btn-sm btn-secondary" ng-click="aumentarCantidad(item)">+</button>
                                        </div>
                                    </td>
                                    <td class="subtotal">${{item.producto.precio * item.cantidad | number:2}}</td>
                                    <td>
                                        <button class="btn btn-sm btn-danger" ng-click="eliminarDelCarrito(item)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="total-carrito" ng-if="carrito.length > 0">
                            <h3>Total: ${{totalCarrito | number:2}}</h3>
                        </div>
                    </div>

                    <!-- Formulario de pago -->
                    <div ng-if="mostrarFormularioPago" class="formulario-pago">
                        <h4 class="mb-4">Datos de Pago</h4>
                        <form name="formPago">
                            <div class="form-group">
                                <label for="nombreCliente">Nombre del Cliente *</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="nombreCliente"
                                       ng-model="formularioPago.nombreCliente" 
                                       placeholder="Ingrese su nombre completo"
                                       required>
                            </div>

                            <div class="form-group">
                                <label for="numeroTarjeta">Número de Tarjeta (Crédito/Débito) *</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="numeroTarjeta"
                                       ng-model="formularioPago.numeroTarjeta" 
                                       placeholder="0000 0000 0000 0000"
                                       maxlength="16"
                                       ng-keypress="validarNumeros($event)"
                                       required>
                            </div>

                            <div class="form-group">
                                <label for="pin">CVV de la Tarjeta *</label>
                                <input type="password" 
                                       class="form-control" 
                                       id="pin"
                                       ng-model="formularioPago.pin" 
                                       placeholder="••••"
                                       maxlength="6"
                                       ng-keypress="validarNumeros($event)"
                                       required>
                            </div>

                            <div class="form-group">
                                <label>Tipo de Entrega *</label>
                                <div class="form-check">
                                    <input class="form-check-input" 
                                           type="radio" 
                                           name="tipoEntrega" 
                                           id="entregaTienda" 
                                           value="tienda"
                                           ng-model="formularioPago.tipoEntrega">
                                    <label class="form-check-label" for="entregaTienda">
                                        <i class="fas fa-store"></i> Retirar en tienda
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" 
                                           type="radio" 
                                           name="tipoEntrega" 
                                           id="entregaDomicilio" 
                                           value="domicilio"
                                           ng-model="formularioPago.tipoEntrega">
                                    <label class="form-check-label" for="entregaDomicilio">
                                        <i class="fas fa-truck"></i> Entrega a domicilio
                                    </label>
                                </div>
                            </div>

                            <div class="form-group" ng-if="formularioPago.tipoEntrega === 'domicilio'">
                                <label for="direccion">Dirección de Entrega *</label>
                                <textarea class="form-control" 
                                          id="direccion"
                                          ng-model="formularioPago.direccion" 
                                          rows="3"
                                          placeholder="Ingrese su dirección completa"
                                          required></textarea>
                            </div>

                            <div class="resumen-pago mt-4 p-3 bg-light rounded">
                                <h5>Resumen del Pedido</h5>
                                <div class="d-flex justify-content-between mb-2">
                                    <span>Subtotal:</span>
                                    <span>${{totalCarrito | number:2}}</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2" ng-if="formularioPago.tipoEntrega === 'domicilio'">
                                    <span>Envío:</span>
                                    <span>$5.00</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <strong>Total a Pagar:</strong>
                                    <strong>${{formularioPago.tipoEntrega === 'domicilio' ? (totalCarrito + 5) : totalCarrito | number:2}}</strong>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="modal-footer">
                    <div ng-if="!mostrarFormularioPago && carrito.length > 0">
                        <button type="button" class="btn btn-cerrar" data-dismiss="modal">CERRAR</button>
                        <button type="button" class="btn btn-pagar" ng-click="iniciarPago()">
                            <i class="fas fa-credit-card"></i> PROCEDER AL PAGO
                        </button>
                    </div>

                    <div ng-if="mostrarFormularioPago">
                        <button type="button" class="btn btn-cancelar" ng-click="cancelarPago()">
                            <i class="fas fa-arrow-left"></i> VOLVER AL CARRITO
                        </button>
                        <button type="button" class="btn btn-pagar" ng-click="realizarPago()">
                            <i class="fas fa-check"></i> CONFIRMAR PAGO
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
    <script src="Funciones.js"></script>
</body>
</html>